#!/usr/bin/env python3
import os
import sys
import time
import requests
import re
import random
from bs4 import BeautifulSoup

# Vers√£o do script
CURRENT_VERSION = "1.8"
PASTEBIN_URL = "https://pastebin.com/raw/aTS029Hq"  # Link correto da vers√£o mais recente

# Fun√ß√£o para colorir texto em RGB
def rgb_color(text):
    r = random.randint(50, 255)
    g = random.randint(50, 255)
    b = random.randint(50, 255)
    return f"\033[38;2;{r};{g};{b}m{text}\033[0m"

# Fun√ß√£o para verificar e atualizar automaticamente
def verificar_atualizacao():
    try:
        response = requests.get(PASTEBIN_URL, timeout=10)
        if response.status_code == 200:
            remote_code = response.text
            match = re.search(r'CURRENT_VERSION = "(.*?)"', remote_code)
            remote_version = match.group(1) if match else "desconhecida"

            if remote_version != CURRENT_VERSION:
                print(rgb_color(f"üÜï Atualiza√ß√£o dispon√≠vel! Vers√£o atual: {CURRENT_VERSION} | Nova vers√£o: {remote_version}"))
                print(rgb_color("Baixando nova vers√£o..."))

                with open(sys.argv[0], "w", encoding="utf-8") as f:
                    f.write(remote_code)

                print(rgb_color("‚úÖ Atualiza√ß√£o conclu√≠da! Execute novamente o script."))
                exit()
            else:
                print(rgb_color("üîÑ Voc√™ j√° est√° usando a vers√£o mais recente."))
        else:
            print(rgb_color("‚ö† Falha ao verificar atualiza√ß√µes: erro no servidor."))
    except Exception as e:
        print(rgb_color(f"‚ùå Erro na verifica√ß√£o de atualiza√ß√£o: {str(e)}"))

# Fun√ß√£o para entrada segura
def safe_input(prompt):
    try:
        return input(rgb_color(prompt))
    except EOFError:
        return None

# Fun√ß√£o para consulta de CEP
def consultar_cep():
    cep = safe_input("Digite o CEP: ")
    if cep is None:
        print(rgb_color("‚ùå Erro: Nenhuma entrada detectada."))
        return

    cep = ''.join(filter(str.isdigit, cep))
    print(rgb_color(f"üîç Consultando CEP {cep}, aguarde..."))

    try:
        url = f"https://www.invertexto.com/consulta-cep"
        response = requests.post(url, data={"cep": cep}, timeout=10)

        if response.status_code == 200:
            soup = BeautifulSoup(response.text, "html.parser")
            resultado = soup.find("div", {"id": "resultado"})
            resultado_text = resultado.get_text(separator="\n", strip=True) if resultado else "‚ö† N√£o foi poss√≠vel encontrar dados do CEP."

            print(rgb_color("üìå Resultado da consulta:"))
            print(rgb_color(resultado_text))
        else:
            print(rgb_color("‚ö† Falha na consulta: erro no servidor."))

    except Exception as e:
        print(rgb_color(f"‚ùå Erro na consulta: {str(e)}"))

    safe_input("üîÑ Aperte Enter para voltar: ")
    time.sleep(1)

# Cabe√ßalho do menu RGB r√°pido
def header():
    os.system("clear")
    print(rgb_color("----------------------------"))
    print(rgb_color("üî• BEM VINDO AO ELCDX PAINEL! üî•"))
    print(rgb_color("----------------------------"))
    print(rgb_color(f"‚öôÔ∏è Vers√£o Atual: {CURRENT_VERSION}"))
    print(rgb_color("----------------------------"))
    print(rgb_color("1Ô∏è‚É£ - Nome."))
    print(rgb_color("2Ô∏è‚É£ - CPF."))
    print(rgb_color("3Ô∏è‚É£ - CNPJ."))
    print(rgb_color("4Ô∏è‚É£ - IP."))
    print(rgb_color("5Ô∏è‚É£ - CEP."))
    print(rgb_color("6Ô∏è‚É£ - Sair."))
    print(rgb_color("----------------------------"))

# Menu principal otimizado
def menu():
    while True:
        header()
        opcao = safe_input("üéØ Escolha uma op√ß√£o: ")
        if opcao is None:
            print(rgb_color("‚ùå Erro: Nenhuma entrada detectada."))
            exit()
        elif opcao == "1":
            print(rgb_color("‚ö† Consulta de nome n√£o implementada."))
        elif opcao == "2":
            print(rgb_color("‚ö† Consulta de CPF n√£o implementada."))
        elif opcao == "3":
            print(rgb_color("‚ö† Consulta de CNPJ n√£o implementada."))
        elif opcao == "4":
            print(rgb_color("‚ö† Consulta de IP n√£o implementada."))
        elif opcao == "5":
            consultar_cep()
        elif opcao == "6":
            print(rgb_color("üëã Saindo..."))
            time.sleep(1)
            exit()
        else:
            print(rgb_color("‚ö† Op√ß√£o inv√°lida, tente novamente."))

if __name__ == "__main__":
    verificar_atualizacao()  # Verifica se h√° atualiza√ß√£o antes de iniciar o menu
    menu()
